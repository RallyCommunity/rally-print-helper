<!DOCTYPE html>
<html>
<head>
    <title>boost-rallyprinter</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){var self=this;self.buildTabs(),self.buildIterationGrids()},buildTabs:function(){var self=this,tab=Ext.create("Ext.tab.Panel",{activeTab:0,border:!1});self.tab=tab,self.add(tab)},buildIterationGrids:function(){var self=this,tab=self.tab,storiesGrid=self.buildGrid("User Stories"),backlogGrid=self.buildGrid("Backlog",!0);self.storiesGrid=storiesGrid,self.backlogGrid=backlogGrid,tab.add(storiesGrid),tab.add(backlogGrid),tab.setActiveTab(0)},buildGrid:function(title,hideIteration){var self=this,store=Ext.create("Rally.data.WsapiDataStore",{model:"User Story",autoLoad:hideIteration});return Ext.create("Ext.grid.Panel",{title:title,store:store,columns:[{xtype:"rownumberer"},{text:"ID",dataIndex:"FormattedID",flex:1},{text:"Story Name",dataIndex:"Name",flex:3}],selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI",allowDeselect:!0}),columnLines:!0,border:!1,tbar:self.buildTbar(hideIteration),emptyText:"No records found"})},buildTbar:function(hideIteration){var self=this,items=[];if(hideIteration)items=["->",{text:"Print"}];else{var store=Ext.create("Rally.data.WsapiDataStore",{model:"Iteration",fetch:!0}),iterationBox=Ext.create("Ext.form.field.ComboBox",{store:store,displayField:"Name",valueField:"ObjectID",triggerAction:"all",listeners:{scope:self,change:self.iterationCallback}});store.on("load",function(st){iterationBox.setValue(st.getAt(0).get("ObjectID"))}),store.load(),items=[iterationBox,"->",{text:"Print"}]}return items},setIterationBoxValue:function(store,data,success){var self=this,iterationBox=self.iterationBox,firstRecord=store.getAt(0);iterationBox.setValue(firstRecord)},iterationCallback:function(cmb,recordId,oldVal,opts){var self=this,storiesStore=self.storiesGrid.getStore(),filters=[{property:"Iteration",operator:"=",value:"/iteration/"+recordId}];storiesStore.reload({filters:filters}),storiesStore.filter(filters)}});

            Rally.launchApp('CustomApp', {
                name:"boost-rallyprinter",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
